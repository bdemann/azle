name: Get tests
description: Gets a list of directories of npm projects with an npm test script
inputs:
    directories:
        description: List of directories to search for npm projects with an npm test script
        required: true
    exclude_dirs:
        description: List of directories to exclude from the search
        required: false
        default: ''
    node_version:
        description: The version of Node.js to use
        required: true
        default: '20.x'
outputs:
    tests:
        description: All of the tests found by this action
        value: ${{ steps.get_tests.outputs.tests }}
runs:
    using: composite
    steps:
        - uses: actions/checkout@v4

        - uses: actions/setup-node@v4
          with:
              node-version: ${{ inputs.node_version }}

        - name: Get tests
          id: get_tests
          run: |
              # Export the input variables to make them available to the script
              export INPUT_DIRECTORIES="${{ inputs.directories }}"
              export INPUT_EXCLUDE_DIRS="${{ inputs.exclude_dirs }}"
              # Run the script
              tests=$(./.github/actions/get_tests/get_tests.sh | base64 -d)
              echo "tests=${tests}" >> "$GITHUB_OUTPUT"
          shell: bash
